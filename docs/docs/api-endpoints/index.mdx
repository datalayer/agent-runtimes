---
title: API Endpoints
---

# API Endpoints

Agent Runtimes exposes a comprehensive REST API for managing agents, executing prompts, and monitoring system status.

## Base URL

```
http://localhost:8765/api/v1
```

## Agents

Manage AI agents and their configurations.

### List Agents

```http
GET /api/v1/agents
```

Returns a list of all registered agents.

**Response:**

```json
{
  "agents": [
    {
      "id": "pydantic-ai",
      "name": "Pydantic AI Agent",
      "transport": "streaming",
      "model": "gpt-4o"
    }
  ]
}
```

### Get Agent

```http
GET /api/v1/agents/{agent_id}
```

Get details for a specific agent.

**Response:**

```json
{
  "id": "pydantic-ai",
  "name": "Pydantic AI Agent",
  "transport": "streaming",
  "model": "gpt-4o",
  "mcp_toolsets": ["tavily", "fetch"]
}
```

### Create Agent

```http
POST /api/v1/agents
Content-Type: application/json
```

Create a new agent.

**Request Body:**

```json
{
  "id": "my-agent",
  "name": "My Custom Agent",
  "model": "gpt-4o",
  "system_prompt": "You are a helpful assistant."
}
```

### Update Agent

```http
PUT /api/v1/agents/{agent_id}
Content-Type: application/json
```

Update an existing agent configuration.

### Update Agent MCP Servers (Runtime)

```http
PATCH /api/v1/agents/{agent_id}/mcp-servers
Content-Type: application/json
```

Dynamically update an agent's selected MCP servers without recreating the agent. This allows adding or removing MCP tools from a running agent.

**Request Body:**

```json
{
  "selected_mcp_servers": ["tavily", "filesystem"]
}
```

**Response:**

```json
{
  "agent_id": "my-agent",
  "selected_mcp_servers": ["tavily", "filesystem"],
  "message": "MCP servers updated successfully"
}
```

### Delete Agent

```http
DELETE /api/v1/agents/{agent_id}
```

Remove an agent from the system.

## Prompts

Execute prompts against agents and manage conversations.

### Send Prompt (Streaming)

```http
POST /api/v1/agents/{agent_id}/prompt
Content-Type: application/json
```

Send a prompt to an agent and receive a streaming response.

**Request Body:**

```json
{
  "message": "What is the weather in Paris?",
  "conversation_id": "optional-conversation-id"
}
```

**Response:** Server-Sent Events (SSE) stream

```
data: {"type": "text", "content": "Based on "}
data: {"type": "text", "content": "the current weather..."}
data: {"type": "tool_call", "name": "get_weather", "args": {...}}
data: {"type": "tool_result", "result": {...}}
data: {"type": "done"}
```

### Send Prompt (Non-Streaming)

```http
POST /api/v1/agents/{agent_id}/prompt/sync
Content-Type: application/json
```

Send a prompt and wait for the complete response.

**Response:**

```json
{
  "response": "Based on the current weather data...",
  "tool_calls": [...],
  "usage": {
    "prompt_tokens": 150,
    "completion_tokens": 200
  }
}
```

## Configuration

System configuration and status endpoints.

### Get Configuration

```http
GET /api/v1/configure
```

Get the current system configuration including available models and MCP servers.

**Response:**

```json
{
  "models": [...],
  "mcp_servers": [...],
  "tools": [...]
}
```

### MCP Toolsets Status

```http
GET /api/v1/configure/mcp-toolsets-status
```

Get the status of MCP toolsets initialization.

**Response:**

```json
{
  "initialized": true,
  "ready_count": 3,
  "failed_count": 0,
  "ready_servers": ["tavily", "linkedin", "kaggle"],
  "failed_servers": {}
}
```

### MCP Toolsets Info

```http
GET /api/v1/configure/mcp-toolsets-info
```

Get detailed information about running MCP toolsets.

**Response:**

```json
[
  {
    "type": "MCPServerStdio",
    "id": "tavily",
    "command": "npx",
    "args": ["-y", "tavily-mcp@0.1.3"]
  }
]
```

## MCP Servers

Manage MCP (Model Context Protocol) servers for tool integration. There are two types of MCP servers:

- **MCP Config**: User-defined servers from `~/.datalayer/mcp.json` that start automatically
- **MCP Catalog**: Predefined servers that can be enabled on-demand

:::info Separate Storage
Config and catalog servers are stored separately, allowing the same server ID to exist in both without conflict. For example, you can have a custom `tavily` server in your `mcp.json` while also having access to the predefined `tavily` in the catalog.
:::

:::tip Starting Without MCP Servers
When you start the server with the [`--no-mcp-servers` CLI flag](/docs/cli#mcp-server-control), no MCP servers are started automatically. You can then use the endpoints below to dynamically enable MCP servers from the catalog at runtime:

```bash
# Start server without MCP servers
python -m agent_runtimes --agent-id crawler --no-mcp-servers

# Then enable MCP servers via API
curl -X POST http://localhost:8000/api/v1/mcp/servers/catalog/tavily/enable
curl -X POST http://localhost:8000/api/v1/mcp/servers/catalog/github/enable
```

This is useful for scenarios where you want fine-grained control over which MCP servers are running, or when you need to manage resources carefully.
:::

### List MCP Config Servers

```http
GET /api/v1/mcp/servers/config
```

Get all running MCP Config servers from `~/.datalayer/mcp.json`. These servers start automatically when the agent runtime starts.

**Response:**

```json
[
  {
    "id": "tavily",
    "name": "Tavily Search",
    "description": "Web search and research capabilities",
    "enabled": true,
    "tools": [
      {
        "name": "tavily-search",
        "description": "Search the web using Tavily",
        "enabled": true
      }
    ],
    "isAvailable": true,
    "isRunning": true,
    "isConfig": true,
    "transport": "stdio"
  }
]
```

### List Catalog Servers

```http
GET /api/v1/mcp/servers/catalog
```

Get all predefined MCP servers from the catalog. These are NOT started automatically.

**Response:**

```json
[
  {
    "id": "tavily",
    "name": "Tavily Search",
    "description": "Web search and research capabilities via Tavily API",
    "enabled": true,
    "tools": [],
    "command": "npx",
    "args": ["-y", "tavily-mcp"],
    "requiredEnvVars": ["TAVILY_API_KEY"],
    "isAvailable": false,
    "isConfig": false,
    "transport": "stdio"
  }
]
```

### List All Available Servers

```http
GET /api/v1/mcp/servers/available
```

Get all available MCP servers - combines catalog servers with running config servers. Since config and catalog servers are stored separately, the same ID can appear in both (as separate entries).

**Response:**

```json
[
  {
    "id": "tavily",
    "name": "Tavily Search",
    "isAvailable": true,
    "isRunning": true,
    "isConfig": true,
    "transport": "stdio"
  },
  {
    "id": "tavily",
    "name": "Tavily Search",
    "description": "Web search via Tavily API",
    "isAvailable": false,
    "isRunning": false,
    "isConfig": false,
    "transport": "stdio"
  }
]
```

Note: The same ID (`tavily`) can appear twice - once from config (user's mcp.json) and once from catalog (predefined).

### List Running Servers

```http
GET /api/v1/mcp/servers
```

Get all currently running MCP servers (both config and catalog).

**Response:**

```json
[
  {
    "id": "tavily",
    "name": "Tavily Search",
    "enabled": true,
    "tools": [
      {
        "name": "tavily-search",
        "description": "A powerful web search tool...",
        "enabled": true,
        "inputSchema": {...}
      }
    ],
    "isAvailable": true
  }
]
```

### Get Server

```http
GET /api/v1/mcp/servers/{server_id}
```

Get details for a specific MCP server.

### Enable Catalog Server

```http
POST /api/v1/mcp/servers/catalog/{server_name}/enable
```

Start an MCP server from the catalog for the current session. Only works for catalog servers (not config servers which start automatically).

This is particularly useful when:
- You started the server with [`--no-mcp-servers`](/docs/cli#mcp-server-control)
- You want to dynamically add tools to an agent at runtime
- You need fine-grained control over which MCP servers are running

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `server_name` | string | The name/ID of the MCP server from the catalog (e.g., `tavily`, `github`, `filesystem`) |

**Example Request:**

```bash
curl -X POST http://localhost:8000/api/v1/mcp/servers/catalog/tavily/enable
```

**Response:** `201 Created`

```json
{
  "id": "tavily",
  "name": "Tavily Search",
  "enabled": true,
  "tools": [
    {
      "name": "tavily-search",
      "description": "Search the web using Tavily"
    }
  ],
  "isRunning": true,
  "isConfig": false
}
```

**Error Responses:**

| Code | Description |
|------|-------------|
| `404` | Server not found in catalog |
| `500` | Failed to start the MCP server |

### Disable Catalog Server

```http
DELETE /api/v1/mcp/servers/catalog/{server_name}/disable
```

Stop an MCP server and remove it from the current session. This stops the MCP server process and frees up resources.

**Path Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `server_name` | string | The name/ID of the MCP server to disable |

**Example Request:**

```bash
curl -X DELETE http://localhost:8000/api/v1/mcp/servers/catalog/tavily/disable
```

**Response:** `204 No Content`

**Error Responses:**

| Code | Description |
|------|-------------|
| `404` | Server is not currently enabled |
| `500` | Failed to stop the MCP server |

### Create Server

```http
POST /api/v1/mcp/servers
Content-Type: application/json
```

Add a new MCP server configuration.

**Request Body:**

```json
{
  "id": "my-server",
  "name": "My Custom Server",
  "command": "npx",
  "args": ["-y", "my-mcp-server"],
  "enabled": true
}
```

### Update Server

```http
PUT /api/v1/mcp/servers/{server_id}
Content-Type: application/json
```

Update an existing MCP server configuration.

### Delete Server

```http
DELETE /api/v1/mcp/servers/{server_id}
```

Remove an MCP server configuration.

**Response:** `204 No Content`

## Extensions

### A2UI Endpoints

```http
GET  /api/v1/a2ui/           # A2UI protocol
GET  /api/v1/a2ui/agents     # List A2UI agents
```

### MCP-UI Endpoints

```http
GET  /api/v1/mcp-ui/         # MCP-UI protocol
GET  /api/v1/mcp-ui/agents   # List MCP-UI agents
```

## Conversations

Manage conversation history and context.

### Get Conversation

```http
GET /api/v1/conversations/{conversation_id}
```

Retrieve a conversation by ID.

### List Conversations

```http
GET /api/v1/conversations
```

List all conversations, optionally filtered by agent.

### Delete Conversation

```http
DELETE /api/v1/conversations/{conversation_id}
```

Delete a conversation and its history.

## Health & Status

### Health Check

```http
GET /api/v1/health
```

**Response:**

```json
{
  "status": "healthy",
  "version": "0.4.5"
}
```

### Readiness Check

```http
GET /api/v1/ready
```

Returns 200 when the service is ready to accept requests.

## Error Responses

All endpoints return standard error responses:

```json
{
  "detail": "Agent not found",
  "status_code": 404
}
```

### Common Status Codes

| Code | Description |
|------|-------------|
| `200` | Success |
| `201` | Created |
| `400` | Bad Request |
| `404` | Not Found |
| `422` | Validation Error |
| `500` | Internal Server Error |

## Authentication

:::info
Authentication is optional and configurable. When enabled, include the API key in the request header:

```http
Authorization: Bearer your-api-key
```
:::

## Rate Limiting

Rate limiting can be configured per endpoint. When rate limited, you'll receive:

```http
HTTP/1.1 429 Too Many Requests
Retry-After: 60
```

## OpenAPI Documentation

Interactive API documentation is available at:

- **Swagger UI:** `http://localhost:8765/docs`
- **ReDoc:** `http://localhost:8765/redoc`
- **OpenAPI JSON:** `http://localhost:8765/openapi.json`
